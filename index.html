<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solar Critters â€¢ Three.js</title>
    <style>
      html, body { margin: 0; height: 100%; overflow: hidden; background: radial-gradient(ellipse at center, #0b0f28 0%, #050713 70%, #000 100%); }
      #app { position: fixed; inset: 0; }
      .hud { position: fixed; left: 12px; bottom: 12px; color: #c8d0ff; font: 12px/1.2 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; opacity: 0.9; pointer-events: none; }
      .hud b { color: #fff; }
      /* Start screen */
      #start { position: fixed; inset: 0; display: grid; place-items: center; background: radial-gradient(1200px 800px at 50% 50%, rgba(10,16,40,0.9), rgba(5,8,20,0.95)); z-index: 10; }
      .panel { width: min(760px, 92vw); border: 1px solid #2a3350; background: rgba(13,18,38,0.85); border-radius: 14px; padding: 20px 22px; color: #dfe6ff; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
      .panel h1 { margin: 2px 0 12px; font-size: 22px; color: #ffffff; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .card { border: 1px solid #334; border-radius: 10px; padding: 12px; background: rgba(18,24,48,0.9); }
      .card h2 { margin: 0 0 8px; font-size: 16px; color: #fff; }
      .card label { display: block; margin: 6px 0; cursor: pointer; }
      .muted { color: #aab3d8; font-size: 12px; }
      .actions { margin-top: 14px; display: flex; gap: 10px; }
      button { background: #6ea8ff; color: #051028; border: 0; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; }
      button.secondary { background: #22314f; color: #cfe1ff; }
      input[type="text"] { width: 100%; padding: 8px 10px; background: #0f162f; border: 1px solid #2b3557; border-radius: 8px; color: #e8eeff; }
      a.link { color: #9cc3ff; text-decoration: none; }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <div id="start">
      <div class="panel">
        <h1>Solar Critters</h1>
        <div class="row">
          <div class="card">
            <h2>Choose a world</h2>
            <label><input type="radio" name="cfg" value="eden" checked> Garden of Eden</label>
            <label><input type="radio" name="cfg" value="wander"> Please Explore</label>
            <label><input type="radio" name="cfg" value="carnival"> Chaos Carnival</label>
            <div class="muted">Pick a vibe; you can still tweak in the GUI later.</div>
          </div>
          <div class="card">
            <h2>Multiplayer (optional)</h2>
            <label>Your name</label>
            <input id="name" type="text" placeholder="e.g. Scrappy" value="Guest">
            <label>Room ID</label>
            <input id="room" type="text" placeholder="e.g. cozy-garden-1234">
            <div class="actions">
              <button id="create">Create room</button>
              <button class="secondary" id="join">Join</button>
              <button class="secondary" id="copy">Copy link</button>
            </div>
            <div id="mpStatus" class="muted">Not connected</div>
            <div class="muted">Uses free WebRTC via a public Peer server. Share the room ID or link.</div>
          </div>
        </div>
        <div class="actions">
          <button id="startBtn">Start</button>
          <button class="secondary" id="skipMp">Start solo</button>
        </div>
      </div>
    </div>
    <div class="hud">Jumping critters: <b>Scrappybara</b>, <b>Blanca</b>, <b>Diagaur</b>, <b>Mochi</b>, <b>Pip</b>. Click planets to follow. Wheel to zoom.</div>
    <script type="module" src="/src/main.ts"></script>
    <script>
      const startEl = document.getElementById('start');
      const roomEl = document.getElementById('room');
      const nameEl = document.getElementById('name');
      const pick = () => (document.querySelector('input[name="cfg"]:checked')||{}).value || 'eden';
      let mpMode = null; // 'host' | 'client' | null
      document.getElementById('create').onclick = () => {
        const id = `garden-${Math.random().toString(36).slice(2,6)}-${Math.floor(Math.random()*900+100)}`;
        roomEl.value = id;
        history.replaceState({}, '', `#${id}`);
        mpMode = 'host';
      };
      document.getElementById('join').onclick = () => {
        if (!roomEl.value) return alert('Enter a room ID');
        history.replaceState({}, '', `#${roomEl.value}`);
        mpMode = 'client';
      };
      document.getElementById('startBtn').onclick = () => {
        const cfg = pick(); const room = roomEl.value || null; const name = nameEl.value || 'Guest';
        window.startGame && window.startGame(cfg, mpMode, room || undefined, name);
        startEl.style.display = 'none';
      };
      document.getElementById('skipMp').onclick = () => {
        const cfg = pick(); const name = nameEl.value || 'Guest';
        window.startGame && window.startGame(cfg, null, undefined, name);
        startEl.style.display = 'none';
      };
      // Auto-fill from URL hash
      if (location.hash.length > 1) {
        roomEl.value = location.hash.slice(1);
      }

      document.getElementById('copy').onclick = async () => {
        try {
          await navigator.clipboard.writeText(location.href);
          const el = document.getElementById('mpStatus');
          if (el) el.textContent = 'Link copied to clipboard!';
          setTimeout(() => { if (el) el.textContent = 'Ready to connect'; }, 1200);
        } catch {}
      };
    </script>
  </body>
</html>
